<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>KudoMessage - Webbapplikation</title>
        <link rel="stylesheet" type="text/css" href="../css/app.style.css" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>
            
            function showNewContactBox(button) {
                if( $('#newContactBox').is(':visible') ) {
                    hideNewContactBox();
                } else {             
                    var position = $(button).position();
                    var left = position.left + 20;
                    var top = position.top + 34;

                    $("#newContactBox").css({top: top + 'px', left: left + 'px'});
                    $("#newContactBox").slideDown("slow");
                }
            }
            
            function hideNewContactBox() {
                $("#newContactBox").hide();
            }
            
            function setNewConversationTextBox(sender) {
                $(".newConversationTextBox").val($(sender).val());
            }
            
        </script>
    </h:head>
    <h:body>
        <h:inputHidden value="#{backendBean.init()}"/>
        
        <h:form>
            <!-- Konversationerna -->
            <div class="contactsKeeper">
                <div style="width: 100%; height: 35px; padding-top: 7px; border-bottom: 1px solid #E0E0E0;">
                    <div class="inputBoxKeeper" style="width: 75%; float: left;">
                        <h:inputText value="Sök..." />
                    </div>
                    <h:commandButton class="sendButton" value="Ny" action="#{conversationsHolder.createNewConversationButton()}" />
                </div>
                
                <c:forEach items="#{conversationsHolder.allConversationsNames}" var="number">
                    <div>
                        <h:commandButton class="contact" action="#{conversationsHolder.setActiveConversation(number)}" value="#{contactsController.getNameOfContact(number)}#{conversationsHolder.getNumUnreadMessages(number)}" />
                    </div>
                </c:forEach>
            </div>

            <div class="messagesKeeper">
                <div style="display: block; height: 42px; width: 100%; position: absolute; border-bottom: 1px solid #E0E0E0;">
                    <p style="line-height: 42px; margin: 0px 0px 0px 20px; display: block;">
                        <c:if test="#{contactsController.hasContact(conversationsHolder.activeConversationName)}">
                            #{contactsController.getNameOfContact(conversationsHolder.activeConversationName)}
                        </c:if>
                        <c:if test="#{!contactsController.hasContact(conversationsHolder.activeConversationName)}">
                            <c:if test="#{!conversationsHolder.newConversation}">
                                #{contactsController.getNameOfContact(conversationsHolder.activeConversationName)}
                                
                                <h:commandButton class="sendButton" style="width: 30px;" value="+" type="button" onclick="showNewContactBox(this)" />      
                                <div id="newContactBox">
                                    Ange ett namn:<br />
                                    <h:inputText value="#{contactsController.tmpContactName}" style="width: 200px;" /><br />
                                    <h:commandButton styleClass="sendButton" style="float: right; width: 130px; margin-top: 5px;" value="Lägg till kontakt" action="#{contactsController.createContactFromJSF(contactsController.tmpContactName, conversationsHolder.activeConversationNumner)}" />
                                    <br style="clear: both;" />
                                </div>
                                
                            </c:if>
                        </c:if>
                        <c:if test="#{conversationsHolder.newConversation}" >
                            
                            <h:inputText class="newConversationTextBox" value="#{conversationsHolder.activeConversationName}" onclick="if(this.value=='Ny konversation'){this.value='';}" />&nbsp;
                            
                            <script>
                                $(".newConversationTextBox").focus();
                            </script>
                            
                            <h:selectOneMenu onchange="setNewConversationTextBox(this)" style="font-size: 16px;">
                                <f:selectItem itemValue="" itemLabel="Välj en kontakt" />
                                <c:forEach items="#{contactsController.nameOfContacts}" var="contact">
                                    <f:selectItem itemValue="#{contactsController.getNumberOfContact(contact)}" itemLabel="#{contact}" />
                                </c:forEach>
                            </h:selectOneMenu>
                            
                        </c:if>
                    </p>
                </div>
                
                <div style="display: block; height: 100%; margin-top: -50px; overflow-y: scroll;">
                    <div style="padding: 100px 10px 10px 10px;">
                        <c:forEach items="#{conversationsHolder.currentConversation}" var="message">
                            <div>
                                <c:if test="#{!conversationsHolder.isSelf(message.origin)}">
                                    <div class="bubble me">
                                        #{message.content}
                                    </div>
                                </c:if>
                                <c:if test="#{conversationsHolder.isSelf(message.origin)}">
                                    <div class="bubble you">
                                        #{message.content}
                                    </div>
                                </c:if>
                                <br style="clear: both;" />
                            </div>
                        </c:forEach>
                    </div>
                </div>
                
                <div style="display: block; height: 40px; padding-top: 9px; border-top: 1px solid #E0E0E0;">
                    <div class="inputBoxKeeper" style="width: 80%; float: left;">
                        <h:inputText value="#{messageModel.messageContent}" />
                    </div>

                    <h:commandButton class="sendButton" action="#{messageModel.sendMessage()}" value="Skicka" />
                </div>
            </div>
        </h:form>
    </h:body>
</html>